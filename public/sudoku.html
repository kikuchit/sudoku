<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Sudoku</title>
  <link rel="stylesheet" href="./sudoku.css" type="text/css">
  <script type="text/javascript">
    function SudokuTable() {
      this.table = [
        [0,8,0,1,7,3,6,0,5],
        [9,0,0,0,0,0,2,0,0],
        [0,1,3,0,0,0,0,0,0],
        [7,4,0,2,5,6,0,0,9],
        [0,0,2,0,9,8,5,7,0],
        [0,0,0,3,1,7,8,2,4],
        [8,6,5,9,3,1,7,4,0],
        [3,2,1,7,6,0,9,5,8],
        [4,0,0,0,0,0,3,6,0]
      ];

      this.initTable = [
        [false,true, false,true, true, true, true, false,true ],
        [true, false,false,false,false,false,true, false,false],
        [false,true, true, false,false,false,false,false,false],
        [true, true, false,true, true, true, false,false,true ],
        [false,false,true, false,true, true, true, true, false],
        [false,false,false,true, true, true, true, true, true ],
        [true, true, true, true, true, true, true, true, false],
        [true, true, true, true, true, false,true, true, true ],
        [true, false,false,false,false,false,true, true, false]
      ];

      this.input = 1;
    };

    SudokuTable.prototype.drawTable = function() {
      var table = document.getElementById('sudoku');
      for(var i = 0; i < table.rows.length; i++) {
        for(var j = 0; j < table.rows[i].cells.length; j++) {
          if(this.table[i][j] != 0) {
            table.rows[i].cells[j].innerHTML = "<div class='readOnlyText'>" + this.table[i][j] + "</div>";
          } else {
            table.rows[i].cells[j].innerHTML = "<div class='normalText'></div>";
          }
        }
      }
    }

    SudokuTable.prototype.setNumber = function(item) {
      var table = document.getElementById('sudoku');

      L:for(var i = 0; i < table.rows.length; i++) {
        for(var j = 0; j < table.rows[i].cells.length; j++) {
          if(table.rows[i].cells[j] != item) {
            continue;
          }

          if(!this.initTable[i][j]) {
            item.firstChild.innerText = this.input;
            this.table[i][j] = this.input;
          }
          break L;
        }
      }
    }

    SudokuTable.prototype.setInputNumber = function(item, number) {
      this.input = number;
      var table = document.getElementById('inputTable');

      for(var i = 0; i < table.rows[0].cells.length; i++) {
        table.rows[0].cells[i].style.backgroundColor = "white";
      }

      item.style.backgroundColor = "red";
    }

    SudokuTable.prototype.resetTable = function() {
      for(var i = 0; i < this.table.length; i++) {
        for(var j = 0; j < this.table[i].length; j++) {
          if(!this.initTable[i][j]) {
            this.table[i][j] = 0;
          }
        }
      }

      this.drawTable();
    }

    SudokuTable.prototype.solve = function() {
      var xhr = new XMLHttpRequest();
      xhr.onreadystatechange = function() {
        if(xhr.readyState == 4) {
          if(xhr.status == 200) {
            alert(xhr.responseText);
          } else {
            alert('Error')
          }
        }
      }

      var req = JSON.stringify(this.table);
      xhr.open('POST', 'http://localhost:4567/solve');
      xhr.setRequestHeader('If-Modified-Since', 'Thu, 01 Jun 1970 00:00:00 GMT');
      xhr.send(req)
    }

    var obj = new SudokuTable();
  </script>
</head>
<body onload="obj.drawTable()">
  <table class="sudokuView" id="sudoku" rules="all">
    <tr>
      <td class="leftTop" onclick="obj.setNumber(this)"></td>
      <td class="top" onclick="obj.setNumber(this)"></td>
      <td class="topSep" onclick="obj.setNumber(this)"></td>
      <td class="top" onclick="obj.setNumber(this)"></td>
      <td class="top" onclick="obj.setNumber(this)"></td>
      <td class="topSep" onclick="obj.setNumber(this)"></td>
      <td class="top" onclick="obj.setNumber(this)"></td>
      <td class="top" onclick="obj.setNumber(this)"></td>
      <td class="rightTop" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftNormal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="rightNormal" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalRightUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalRightUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="rightSep" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftNormal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="rightNormal" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftNormal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="rightNormal" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalRightUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalRightUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="normalUnderSep" onclick="obj.setNumber(this)"></td>
      <td class="rightSep" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftNormal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="rightNormal" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftNormal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normalRightSep" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="normal" onclick="obj.setNumber(this)"></td>
      <td class="rightNormal" onclick="obj.setNumber(this)"></td>
    </tr>
    <tr>
      <td class="leftUnder" onclick="obj.setNumber(this)"></td>
      <td class="under" onclick="obj.setNumber(this)"></td>
      <td class="underSep" onclick="obj.setNumber(this)"></td>
      <td class="under" onclick="obj.setNumber(this)"></td>
      <td class="under" onclick="obj.setNumber(this)"></td>
      <td class="underSep" onclick="obj.setNumber(this)"></td>
      <td class="under" onclick="obj.setNumber(this)"></td>
      <td class="under" onclick="obj.setNumber(this)"></td>
      <td class="rightUnder" onclick="obj.setNumber(this)"></td>
    </tr> 
  </table>
  <br>
  <table class="inputTable" id="inputTable" rules="all">
    <tr>
      <td class="inputCell" onclick="obj.setInputNumber(this, 1)">1</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 2)">2</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 3)">3</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 4)">4</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 5)">5</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 6)">6</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 7)">7</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 8)">8</td>
      <td class="inputCell" onclick="obj.setInputNumber(this, 9)">9</td>
    </tr>
  </table>
  <input type="button" class="button" name="reset" value="やり直し" onclick="obj.resetTable()">
  <input type="button" class="button" name="solve" value="回答" onclick="obj.solve()">
</body>
</html>